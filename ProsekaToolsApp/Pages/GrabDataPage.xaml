<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="ProsekaToolsApp.Pages.GrabDataPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <StackPanel Padding="24">
        <TextBlock
            FontSize="30"
            FontWeight="SemiBold"
            Text="数据抓取" />
        <TextBlock
            Margin="0,24,0,0"
            FontSize="12"
            FontWeight="SemiBold"
            Text="当前本机ip:" />
        <TextBlock
            FontSize="14"
            FontWeight="Normal"
            Text="{Binding LocalIp}" />
        <Button Margin="0,12,0,0" Content="生成MitM配置文件" />
        <!-- 新增：放行 8000 端口的防火墙规则按钮 -->
        <Button x:Name="FirewallButton" Margin="0,8,0,0" Click="AddFirewallRule_Click" Content="放行防火墙端口 8000" />
        <!--  Capture Server 开关与状态  -->
        <Border
            Height="1"
            Margin="0,24,0,12"
            Background="#33000000" />
        <TextBlock
            FontSize="16"
            FontWeight="SemiBold"
            Text="Capture Server (:8000)" />
        <ToggleSwitch
            x:Name="ServerToggle"
            Margin="0,8,0,0"
            Header="开启/关闭"
            OffContent="已停止"
            OnContent="运行中"
            Toggled="ServerToggle_Toggled" />
        <TextBlock Margin="0,8,0,0" Text="{Binding ServerStatus}" />
        <TextBlock Margin="0,4,0,0" Opacity="0.7">
            <Run Text="监听: http://" />
            <Run Text="{Binding LocalIp}" />
            <Run Text=":8000/" />
        </TextBlock>

        <!--  数据包获取状态显示框  -->
        <Border
            Height="1"
            Margin="0,24,0,12"
            Background="#33000000" />
        <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
            <TextBlock
                FontSize="16"
                FontWeight="SemiBold"
                Text="数据包获取状态" />
            <Button
                Margin="12,0,0,0"
                Click="ClearLogs_Click"
                Content="清空" />
        </StackPanel>
        <ListView
            x:Name="LogsList"
            Height="260"
            Margin="0,8,0,0"
            ItemsSource="{Binding CaptureLogs}">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <TextBlock
                        Opacity="0.9"
                        Text="{Binding}"
                        TextWrapping="WrapWholeWords" />
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </StackPanel>
</Page>
